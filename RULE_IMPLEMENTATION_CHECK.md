# 보드게임 규칙 구현 상태 체크 (2024-12-03)

## 1. AI 알고리즘

### ✅ 구현 완료
- [x] 이동 결정 알고리즘
- [x] 행동 결정 알고리즘
- [x] 결심 토큰 사용 전략 (2-5일, 10-12일 중 각 1번)
- [x] 공동 계획 기여 결정 (3,000~9,000TC)
- [x] 최종 구매 결정 (여행지 테마 기반)
- [x] 비주류 특성 변환 결정 (모든 비주류 특성 변환)
- [x] 턴 종료 로직

### ✅ 구현 완료 (백엔드)
- [x] **찬스 카드 상호작용 처리** (CH8~CH13)
  - CH8: 친구와 집안일 ✅
  - CH9: 공동 지원 이벤트 ✅
  - CH10: 계획 구매 요청 ✅
  - CH11: 계획 교환 ✅
  - CH12: 모두 내 자리로 ✅
  - CH13: 자리 바꾸기 ✅

- [x] **찬스 카드 특수 행동** (일부)
  - CH14: 여행 이야기 듣기 ✅
  - CH15: 좋은 정보 발견 ✅
  - CH18: 체력이 넘친다! ✅
  - CH19: 반전의 기회 ✅

### ⚠️ 미구현
- [ ] **찬스 카드 특수 행동** (일부)
  - CH16: 버린만큼 뽑기 (버린 카드 추적 시스템 필요)
  - CH17: 여행 팜플렛 (공동 목표 카드 선택 UI 필요)
  - CH20: 공동 목표 지원 (구현 가능, 간단)

- [ ] **캐치업 카드** (CH21~CH25)
  - CH21: 엄마의 응원 (TC 가장 적은 사람 +2,000TC)
  - CH22: 여행 선생님의 조언 (일반 계획 가장 적은 사람 +1) - CH14와 유사
  - CH23: 가족 사진 대작전 (추억 가장 낮은 사람 +2)
  - CH24: 엄마의 응원 메시지 (추억 가장 낮은 사람 +2)
  - CH25: 동행 버디 (본인 행동1회, 지목1명 행동1회)

- [ ] **프론트엔드 UI**
  - 찬스 카드 상호작용 모달
  - 플레이어 선택 UI
  - 카드 선택 UI
  - 응답 대기 UI

---

## 2. 게임 진행 규칙

### ✅ 구현 완료
- [x] 턴 순서: 이동 → 행동
- [x] 이동 제약: 인접 칸, 직전 행동 칸 불가
- [x] 행동 칸 1~6번 구현
- [x] 추가 행동 (결심 토큰 사용)
- [x] 직전 행동 칸 반복 불가
- [x] 14일차 규칙 (이동 & 행동 필수)
- [x] Day 전환 로직 (1~14일)
- [x] 선플레이어 순환

### ✅ 구현 완료 (행동 칸)
- [x] 1번: 무료 계획 (무료 계획 카드 1장 획득)
- [x] 2번: 조사하기 (일반 계획 카드 1장 손패에 추가)
- [x] 3번: 집안일 (집안일 카드 1장 획득, TC 수익)
- [x] 4번: 여행 지원 (여행 지원 카드 1장 획득, TC 변동)
- [x] 5번: 찬스 (찬스 카드 1장 획득)
- [x] 6번: 자유 행동 (1~5번 중 선택)

### ⚠️ 미구현 또는 불완전
- [ ] **강제 이동 예외 처리**
  - 찬스 카드로 강제 이동 시 "직전 턴 행동 칸 불가" 규칙 미적용
  - 현재: 강제 이동 로직 자체가 미구현

- [ ] **카드 더미 소진 규칙**
  - 덱 비었을 때 버린 카드 더미 재충전
  - 완전 소진 시 더 이상 뽑을 수 없음
  - 현재: 덱 소진 처리 미확인

---

## 3. 결심 토큰 규칙

### ✅ 구현 완료
- [x] 기본 최대 보유량 2개
- [x] 이동 없이 행동 1회 추가
- [x] 직전 행동 칸 반복 불가
- [x] 주간 회복 규칙 (1~6일차 미사용 시 7일차에 1개 회복)
  - 구현 위치: `TurnManager.ts` Day 8 시작 시 체크

### ✅ AI 결심 토큰 사용
- [x] 2-5일 중 1번 사용
- [x] 10-12일 중 1번 사용
- [x] 확률적 사용 결정

---

## 4. 공동 목표 규칙

### ✅ 구현 완료
- [x] 14일차 최종 결산 직후 진행
- [x] TC 기여 금액 입력
- [x] 총합 계산 및 목표 달성 여부 확인
- [x] 성공 시 보너스 효과 적용
- [x] 실패 시 패널티 (3~5인: 최소 기여자 추억 -2)
- [x] 2인 플레이 패널티 면제

### ⚠️ 미구현
- [ ] **TC 동시 공개 메커니즘**
  - 현재: 순차적으로 입력
  - 룰북: 비밀리에 손에 쥐고 동시 공개
  - 영향: 게임플레이에 큰 영향 없음 (온라인 특성상)

---

## 5. 게임 종료 규칙

### ✅ 구현 완료
- [x] 14일차 모든 플레이어 턴 완료 후 종료
- [x] 게임 상태 'finalizing'으로 변경
- [x] 최종 결산 단계 진입

---

## 6. 게임 종료 후 점수 산정

### ✅ 구현 완료
- [x] 일반 계획 카드 구매 (선택)
  - 최종 구매 모달 표시
  - TC 지불하여 구매
  - 구매한 카드만 점수 계산

- [x] 공동 목표 판정
  - 기여 금액 입력
  - 성공/실패 판정
  - 보너스/패널티 적용

- [x] 비주류 특성 변환 (선택)
  - 가중치 1배 특성 3점 → 추억 +1
  - 원하는 만큼 반복 가능

- [x] 최종 점수 계산
  - (특성 점수 × 여행지 가중치) + 추억 점수 + 공동 목표 보너스

- [x] 승리 판정 및 동률 규정
  - 1순위: 최종 행복 점수
  - 2순위: 추억 점수
  - 3순위: 남은 TC
  - 최종: 공동 우승

---

## 7. 2인 전용 규칙

### ✅ 구현 완료
- [x] 공동 목표 패널티 면제
- [x] 찬스 칸 강화 (찬스 카드 or 500TC 선택)
- [x] 집안일 칸 첫 방문 보너스 (+500TC)

### ⚠️ 미구현
- [ ] **2인 전용 찬스 카드 필터링**
  - CH11, CH12, CH13 제거
  - 현재: 모든 찬스 카드 포함 (확인 필요)

---

## 8. 카드 효과 구현

### ✅ 구현 완료
- [x] 여행지 카드 (10장) - 가중치 적용
- [x] 무료 계획 카드 (8장) - 특성 및 추억 점수 즉시 적용
- [x] 일반 계획 카드 (40장) - 손패에 추가, 최종 구매
- [x] 집안일 카드 (13장) - TC 수익 (1,500~2,000TC)
- [x] 여행 지원 카드 (16장) - TC 변동 효과

### ⚠️ 미구현 또는 불완전
- [ ] **찬스 카드 (26장) 효과 구현**
  - 기본 TC 변동 카드 (CH1~CH7): 구현됨
  - 상호작용 카드 (CH8~CH13): 미구현
  - 유틸리티 카드 (CH14~CH17): 미구현
  - 특수 행동 카드 (CH18~CH20): 미구현
  - 캐치업 카드 (CH21~CH25): 미구현

---

## 우선순위별 미구현 항목

### 🔴 높음 (게임 플레이에 필수)
1. **찬스 카드 프론트엔드 UI** (CH8~CH25)
   - 백엔드: 대부분 구현됨 ✅
   - 프론트엔드: 상호작용 모달 미구현 ⚠️
   - 플레이어 선택, 카드 선택, 응답 대기 UI 필요

2. **캐치업 카드 구현** (CH21~CH25)
   - 백엔드 로직 추가 필요
   - 최저/최고 플레이어 찾기 로직

3. **카드 더미 소진 규칙**
   - 덱 재충전 및 완전 소진 처리

### 🟡 중간 (게임 경험 향상)
4. **강제 이동 예외 처리**
   - 찬스 카드로 강제 이동 시 규칙 예외 적용
   - CH12 (모두 내 자리로) 구현됨, 예외 처리 필요

5. **2인 전용 찬스 카드 필터링**
   - CH11, CH12, CH13 제거
   - 백엔드에서 `forbidden_2p` 체크 구현됨 ✅
   - 카드 데이터에 메타데이터 추가 필요

6. **AI 찬스 카드 대응 로직**
   - 상호작용 카드에 대한 AI 응답
   - 현재: 기본 처리만 구현됨

### 🟢 낮음 (선택적)
7. **CH16, CH17, CH20 구현**
   - CH16: 버린 카드 추적 시스템 필요
   - CH17: 공동 목표 카드 선택 UI 필요
   - CH20: 간단히 구현 가능

8. **TC 동시 공개 메커니즘**
   - 온라인 특성상 큰 영향 없음

---

## 결론

### 완전히 구현된 부분
- ✅ 기본 게임 진행 규칙 (이동, 행동, 턴 순서)
- ✅ 결심 토큰 시스템
- ✅ 공동 목표 시스템
- ✅ 게임 종료 및 점수 산정
- ✅ 2인 전용 규칙 (대부분)
- ✅ AI 기본 알고리즘
- ✅ **찬스 카드 백엔드 로직 (대부분)** - CH8~CH15, CH18~CH19

### 미구현 또는 불완전한 부분
- ⚠️ **찬스 카드 프론트엔드 UI** - 가장 큰 누락
  - 상호작용 모달, 플레이어 선택, 카드 선택 UI
- ⚠️ **캐치업 카드 (CH21~CH25)** - 백엔드 로직 필요
- ⚠️ 카드 더미 소진 규칙
- ⚠️ 강제 이동 예외 처리
- ⚠️ 2인 전용 찬스 카드 필터링 (카드 데이터 메타데이터)

### 권장 작업 순서
1. **찬스 카드 프론트엔드 UI 구현** (가장 중요)
   - 상호작용 모달 컴포넌트
   - 플레이어 선택 UI
   - 카드 선택 UI
   - 응답 대기 및 결과 표시

2. **캐치업 카드 구현** (CH21~CH25)
   - 백엔드 로직 추가
   - 최저/최고 플레이어 찾기

3. **카드 더미 소진 처리**
   - 덱 재충전 로직
   - 완전 소진 처리

4. **2인 전용 찬스 카드 필터링**
   - 카드 데이터에 `forbidden_2p` 메타데이터 추가

5. **AI 찬스 카드 대응 로직**
   - 상호작용 카드 응답 알고리즘

### 게임 플레이 가능 여부
- **현재 상태:** 기본 게임 플레이 가능 ✅
- **찬스 카드:** 기본 TC 변동 카드만 작동
- **상호작용 카드:** 백엔드 구현됨, UI 없음
- **권장:** 찬스 카드 UI 구현 후 정식 플레이
