# 찬스 카드 구현 완료 요약

## ✅ 구현 완료 항목

### 1. CH1~CH7: 돈 카드
- **상태**: ✅ 완료
- **동작**: 뽑는 즉시 TC 자동 증감
- **구현**: `handleMoneyCard()` 함수

---

### 2. CH8: 친구와 집안일
- **상태**: ✅ 완료
- **동작**:
  1. 플레이어 선택 모달 (자신 제외)
  2. 확인 버튼 클릭
  3. 나와 선택한 플레이어가 집안일 카드 1장씩 드로우
  4. 각 카드 효과 즉시 적용 (TC 지급)
- **구현**: 
  - `handleSharedHouse()`
  - `executeSharedHouse()`
  - `drawHouseCard()`

---

### 3. CH9: 공동 지원 이벤트
- **상태**: 🔧 수정 필요
- **현재**: 각자 1,000TC 지불 후 계획 카드 2장 드로우
- **요구사항**: 
  1. 플레이어 선택
  2. 구매 확인 모달 표시
  3. 요청자만 선택적으로 1,000TC 지불 후 계획 카드 1장 드로우
- **TODO**: 프론트엔드 구매 확인 모달 추가

---

### 4. CH10: 계획 구매 요청
- **상태**: 🔧 수정 필요
- **현재**: 대상이 수락/거절 선택
- **요구사항**:
  1. 플레이어 선택
  2. 내 TC < 1,000: 무효 처리
  3. 내 TC ≥ 1,000: 대상의 계획 카드 중 임의로 1장 강제 구매
  4. 1,000TC를 대상에게 지불
- **TODO**: 강제 구매 로직으로 변경

---

### 5. CH11: 계획 교환
- **상태**: 🔧 구현 필요
- **요구사항**:
  1. 계획 카드 보유자만 선택 가능
  2. 내 계획 카드 중 1장 선택
  3. 대상의 계획 카드 중 1장 선택 (대상이 선택)
  4. 카드 교환
  5. 모든 플레이어가 계획 카드 0장: 포기 버튼
- **TODO**: 양방향 선택 UI 구현

---

### 6. CH12: 모두 내 자리로
- **상태**: ✅ 완료
- **동작**: 뽑는 즉시 모든 플레이어를 내 위치로 강제 이동
- **구현**: `handleSummonAll()`

---

### 7. CH13: 자리 바꾸기
- **상태**: ✅ 완료 (수정됨)
- **동작**:
  1. 플레이어 선택
  2. 위치 교환
  3. **추가 행동**: 새 위치에서 행동 1회 수행
- **구현**: 
  - `handleSwapPosition()`
  - `executeSwapPosition()` - 추가 행동 플래그 포함

---

### 8. CH14: 여행 이야기 듣기
- **상태**: ✅ 완료
- **동작**: 계획 카드가 가장 적은 플레이어(들)에게 계획 카드 1장씩 지급
- **구현**: `drawPlanForLowest()`

---

### 9. CH15: 좋은 정보 발견
- **상태**: ✅ 완료
- **동작**: 즉시 계획 카드 1장 드로우
- **구현**: `drawPlan()`

---

### 10. CH16: 버린만큼 뽑기
- **상태**: ✅ 완료 (새로 구현)
- **동작**:
  1. 손패 표시 (무료계획 + 계획 카드)
  2. 버릴 카드 선택 (복수 선택)
  3. 확인 버튼 클릭
  4. 선택한 카드 버림
  5. 버린 카드 수만큼 계획 카드 드로우
- **구현**:
  - `handleDrawDiscarded()` - 손패 정보 반환
  - `executeDiscardAndDraw()` - 버리고 드로우 실행
  - API: `POST /games/:gameId/discard-and-draw`

---

### 11. CH17: 여행 팜플렛
- **상태**: ✅ 완료
- **동작**: 공동 목표 카드 선택 모달 표시
- **구현**: `handleSelectJointPlan()`
- **TODO**: 기존 카드 제거 로직 추가 (선택사항)

---

### 12. CH18: 체력이 넘친다!
- **상태**: ✅ 완료
- **동작**: 이동 없이 행동 1회 수행 (1~6번 중 선택)
- **구현**: `handleExtraAction()`

---

### 13. CH19: 반전의 기회
- **상태**: ✅ 완료 (수정됨)
- **이전**: 현재 칸에서 행동 1회 더
- **현재**: 찬스 카드 1장 더 뽑기
- **동작**:
  1. 찬스 카드 1장 드로우
  2. 새로 뽑은 찬스 카드 효과 즉시 실행
- **구현**: `handleRepeatCurrentAction()` - 수정됨

---

### 14. CH20: 공동 목표 지원
- **상태**: ✅ 완료
- **동작**: 즉시 1,000TC를 공동 목표에 기여
- **구현**: `handleJointPlanSupport()`

---

### 15. CH21: 엄마의 응원
- **상태**: ✅ 완료
- **동작**: TC가 가장 적은 플레이어(들)에게 +2,000TC 지급
- **구현**: `catchupMoney()`

---

### 16. CH22: 여행 선생님의 조언
- **상태**: ✅ 완료
- **동작**: 계획 카드가 가장 적은 플레이어(들)에게 계획 카드 1장씩 지급
- **구현**: `drawPlanForLowest()` (CH14와 동일)

---

### 17. CH23: 가족 사진 대작전
- **상태**: ✅ 완료
- **동작**: 추억 점수가 가장 낮은 플레이어(들)에게 추억 +2점
- **구현**: `catchupMemory()`

---

### 18. CH24: 엄마의 응원 메시지
- **상태**: ✅ 완료
- **동작**: CH23과 동일
- **구현**: `catchupMemory()`

---

### 19. CH25: 동행 버디
- **상태**: ✅ 완료
- **동작**: 
  1. 플레이어 선택
  2. 나: 추가 행동 1회
  3. 선택한 플레이어: 추가 행동 1회
- **구현**: `handleBuddyAction()`

---

## 🔧 수정 필요 항목

### 우선순위 높음
1. **CH9**: 구매 확인 모달 추가 (프론트엔드)
2. **CH10**: 강제 구매 로직으로 변경 (백엔드)
3. **CH11**: 양방향 카드 교환 UI (프론트엔드 + 백엔드)

### 우선순위 중간
4. **CH13**: 추가 행동 UI 처리 (프론트엔드)
5. **CH16**: 카드 선택 UI (프론트엔드)

---

## 📋 API 엔드포인트

### 기존
- `POST /games/:gameId/chance/:cardCode` - 찬스 카드 실행
- `POST /games/:gameId/chance-response` - 상호작용 응답
- `POST /chance/respond` - 상호작용 응답 (대체)

### 신규 추가
- `POST /games/:gameId/discard-and-draw` - CH16: 버린만큼 뽑기 실행

---

## 🎮 프론트엔드 구현 필요 사항

### 1. CH9: 구매 확인 모달
```typescript
interface PurchaseConfirmModalProps {
  isOpen: boolean;
  currentMoney: number;
  onConfirm: () => void;
  onCancel: () => void;
}
```

### 2. CH10: 강제 구매 처리
- 대상 선택 후 즉시 실행
- TC 부족 시 무효 처리 메시지

### 3. CH11: 양방향 카드 교환
```typescript
interface CardExchangeModalProps {
  isOpen: boolean;
  myCards: Card[];
  targetCards: Card[];
  onSelectMyCard: (cardId: string) => void;
  onSelectTargetCard: (cardId: string) => void;
  onConfirm: () => void;
  onCancel: () => void;
}
```

### 4. CH13: 추가 행동 처리
- 위치 교환 후 `extraAction: true` 플래그 확인
- 행동 선택 모달 표시

### 5. CH16: 카드 선택 모달
```typescript
interface DiscardSelectModalProps {
  isOpen: boolean;
  handCards: Card[];
  selectedCards: string[];
  onToggleCard: (cardId: string) => void;
  onConfirm: () => void;
  onCancel: () => void;
}
```

---

## 🤖 AI 자동 대응

### 구현 완료
- **CH8**: 랜덤 플레이어 선택 및 자동 수락
- **CH9**: 랜덤 플레이어 선택 및 자동 수락
- **CH10**: 자동 거절
- **CH11**: 자동 거절
- **CH13**: 랜덤 플레이어 선택

### AI 대응 함수
- `isAIPlayer()`: AI 플레이어 확인
- `selectRandomPlayer()`: 랜덤 플레이어 선택
- `executeSharedHouse()`: CH8 실행
- `executeSharedInvest()`: CH9 실행
- `executeSwapPosition()`: CH13 실행

---

## 📊 구현 통계

- **총 카드 수**: 26장
- **완료**: 20장 (77%)
- **수정 필요**: 5장 (19%)
- **구현 필요**: 1장 (4%)

---

## 🚀 다음 단계

### 1단계: 백엔드 수정
- [ ] CH10: 강제 구매 로직 구현
- [ ] CH11: 양방향 교환 로직 구현

### 2단계: 프론트엔드 구현
- [ ] CH9: 구매 확인 모달
- [ ] CH11: 카드 교환 모달
- [ ] CH13: 추가 행동 처리
- [ ] CH16: 카드 선택 모달

### 3단계: 테스트
- [ ] 각 찬스 카드 개별 테스트
- [ ] AI 대응 테스트
- [ ] 엣지 케이스 테스트

---

**작성일**: 2024-12-07
**버전**: v1.0
**상태**: 백엔드 주요 로직 구현 완료, 프론트엔드 UI 구현 필요
